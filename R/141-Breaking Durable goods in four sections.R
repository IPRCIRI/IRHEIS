#141-Breaking Durable goods in four section
# 
# Copyright Â© 2020:  Arin Shahbazian
# Licence: GPL-3

rm(list=ls())

starttime <- proc.time()
cat("\n\n================ Breaking Durable goods in four section =====================================\n")

library(yaml)
Settings <- yaml.load_file("Settings.yaml")

library(readxl)
library(stringr)
library(data.table)
library(ggplot2)
library(spatstat)
library(dplyr)

for(year in (Settings$startyear:Settings$endyear)){
  cat(paste0("\n------------------------------\nYear:",year,"\n"))
  
  #load Demos+FoodPrices+Weights
  load(file=paste0(Settings$HEISProcessedPath,"Y",year,"TotalDurableDetails.rda"))
  TotalDurable[is.na(TotalDurable)] <- 0

  if (year==97 | year==96 | year==98){
    g1 <- c("43222",
            "43223",
            "43224",
            "43225",
            "53312",
            "54044",
            "55113",
            "56221",
            "72415",
            "72416",
            "72417",
            "72422",
            "91511",
            "91515",
            "91516",
            "93119",
            "93121",
            "93122",
            "93124",
            "93125",
            "93126",
            "93411",
            "93412",
            "93414",
            "93416",
            "93417",
            "95111",
            "95112",
            "95113",
            "95114",
            "95115",
            "95121",
            "95125",
            "96111",
            "96112",
            "96113",
            "96114",
            "101111",
            "101112",
            "101113",
            "101114",
            "101115",
            "102111",
            "102112",
            "102113",
            "102114",
            "102211",
            "102212",
            "102213",
            "102214",
            "102215",
            "103111",
            "103112",
            "103113",
            "103114",
            "103115",
            "103116",
            "104111",
            "104112",
            "104113",
            "104114",
            "104115",
            "105111",
            "105112",
            "105113",
            "105114",
            "105115",
            "124113",
            "125111",
            "125112",
            "125113",
            "125114",
            "125115",
            "125116",
            "125117",
            "125118",
            "125119",
            "125121",
            "125211",
            "125212",
            "125311",
            "125312",
            "125313",
            "125314",
            "125315",
            "125316",
            "125317",
            "125411",
            "125412",
            "125413",
            "125511",
            "126111",
            "126112",
            "126211",
            "126212",
            "127111",
            "127113",
            "127114",
            "127115",
            "127116",
            "127117",
            "127118",
            "127119",
            "127121",
            "127122",
            "127123",
            "127124",
            "127125",
            "127126",
            "127127",
            "127128",
            "127132",
            "127134",
            "127136",
            "127137",
            "139111",
            "139112",
            "139113",
            "139114",
            "139115",
            "139116",
            "139211",
            "139212",
            "139213",
            "139214",
            "139215",
            "139216",
            "139217")
    
    g2 <- c("53111",
            "53112",
            "53113",
            "53116",
            "53125",
            "53129",
            "53132",
            "53216",
            "71111",
            "71112",
            "71116",
            "71117",
            "71211",
            "71311",
            "71312",
            "72111",
            "72118",
            "72119",
            "82111",
            "82113",
            "91111",
            "91117",
            "91122",
            "91128",
            "91129",
            "91311")
    
    g3 <- c("31231",
            "31243",
            "31315",
            "31413",
            "43111",
            "43112",
            "43113",
            "43114",
            "43117",
            "43118",
            "43121",
            "43122",
            "43124",
            "43125",
            "43126",
            "43127",
            "43129",
            "43131",
            "43132",
            "43134",
            "43135",
            "43211",
            "43212",
            "43213",
            "43214",
            "43215",
            "43216",
            "43217",
            "43218",
            "43219",
            "51141",
            "51142",
            "51143",
            "51153",
            "51154",
            "51156",
            "51158",
            "51159",
            "51161",
            "51171",
            "51172",
            "51173",
            "51174",
            "51175",
            "51211",
            "51212",
            "51213",
            "51214",
            "51215",
            "51311",
            "51312",
            "53115",
            "53117",
            "53118",
            "53119",
            "53121",
            "53134",
            "53135",
            "53138",
            "53139",
            "53141",
            "53211",
            "53212",
            "53213",
            "53214",
            "53225",
            "53311",
            "54022",
            "54023",
            "54025",
            "54045",
            "55111",
            "55112",
            "71314",
            "72113",
            "72117",
            "72122",
            "72123",
            "72127",
            "72131",
            "72132",
            "72133",
            "72135",
            "72137",
            "72139",
            "72141",
            "72142",
            "72311",
            "72319",
            "72321",
            "72323",
            "72413",
            "72414",
            "72421",
            "82112",
            "82117",
            "91119",
            "91121",
            "91125",
            "91126",
            "91127",
            "91212",
            "91224",
            "91225",
            "91312",
            "91313",
            "91315",
            "91316",
            "91317",
            "91319",
            "91325",
            "92122",
            "92211",
            "92213",
            "92214",
            "92313",
            "93118",
            "93127",
            "93129",
            "93212",
            "93213",
            "93214",
            "93216",
            "93218",
            "93219",
            "93223",
            "93224",
            "93226",
            "93228",
            "93229",
            "93233",
            "93235",
            "93315",
            "93316",
            "123111",
            "123112",
            "123113",
            "123121",
            "123122",
            "123131",
            "123133",
            "123134",
            "123224",
            "123225")
    
    g4 <- c("61211",
            "61214",
            "62124",
            "62125",
            "62126",
            "62127",
            "63141",
            "63142",
            "63143",
            "63144",
            "63145",
            "63146",
            "63147",
            "63148",
            "63149",
            "63151",
            "63152")
  }
  
  if (year==95){
    g1 <- c("43222",
            "43223",
            "43224",
            "43225",
            "53312",
            "54044",
            "55113",
            "56221",
            "72415",
            "72416",
            "72417",
            "72422",
            "91511",
            "91515",
            "91516",
            "93119",
            "93121",
            "93122",
            "93124",
            "93125",
            "93126",
            "93411",
            "93412",
            "93414",
            "93416",
            "93417",
            "95111",
            "95112",
            "95113",
            "95114",
            "95115",
            "95121",
            "95125",
            "96111",
            "96112",
            "96113",
            "96114",
            "101111",
            "101112",
            "101113",
            "101114",
            "101115",
            "102111",
            "102112",
            "102113",
            "102114",
            "102211",
            "102212",
            "102213",
            "102214",
            "102215",
            "103111",
            "103112",
            "103113",
            "103114",
            "103115",
            "103116",
            "104111",
            "104112",
            "104113",
            "104114",
            "104115",
            "105111",
            "105112",
            "105113",
            "105114",
            "105115",
            "124113",
            "125111",
            "125112",
            "125113",
            "125114",
            "125115",
            "125116",
            "125117",
            "125118",
            "125119",
            "125121",
            "125211",
            "125212",
            "125311",
            "125312",
            "125313",
            "125314",
            "125315",
            "125316",
            "125317",
            "125411",
            "125412",
            "125413",
            "125511",
            "126111",
            "126112",
            "126211",
            "126212",
            "127111",
            "127113",
            "127114",
            "127115",
            "127116",
            "127117",
            "127118",
            "127119",
            "127121",
            "127122",
            "127123",
            "127124",
            "127125",
            "127126",
            "127127",
            "127128",
            "127132",
            "127134",
            "127136",
            "127137",
            "139111",
            "139112",
            "139113",
            "139114",
            "139115",
            "139116",
            "139211",
            "139212",
            "139213",
            "139214",
            "139215",
            "139216",
            "139217")
    
    g2 <- c("53111",
            "53112",
            "53113",
            "53116",
            "53125",
            "53129",
            "53132",
            "53216",
            "71111",
            "71112",
            "71116",
            "71117",
            "71211",
            "71311",
            "71312",
            "72111",
            "72118",
            "72119",
            "82111",
            "82113",
            "91111",
            "91117",
            "91122",
            "91128",
            "91129",
            "91311")
    
    g3 <- c("31231",
            "31243",
            "31315",
            "31413",
            "43111",
            "43112",
            "43113",
            "43114",
            "43117",
            "43118",
            "43121",
            "43122",
            "43124",
            "43125",
            "43126",
            "43127",
            "43129",
            "43131",
            "43132",
            "43134",
            "43135",
            "43211",
            "43212",
            "43213",
            "43214",
            "43215",
            "43216",
            "43217",
            "43218",
            "43219",
            "51141",
            "51142",
            "51143",
            "51153",
            "51154",
            "51156",
            "51158",
            "51159",
            "51161",
            "51171",
            "51172",
            "51173",
            "51174",
            "51175",
            "51211",
            "51212",
            "51213",
            "51214",
            "51215",
            "51311",
            "51312",
            "53115",
            "53117",
            "53118",
            "53119",
            "53121",
            "53134",
            "53135",
            "53138",
            "53139",
            "53141",
            "53211",
            "53212",
            "53213",
            "53214",
            "53225",
            "53311",
            "54022",
            "54023",
            "54025",
            "54045",
            "55111",
            "55112",
            "71314",
            "72113",
            "72117",
            "72122",
            "72123",
            "72127",
            "72131",
            "72132",
            "72133",
            "72135",
            "72137",
            "72139",
            "72141",
            "72142",
            "72311",
            "72319",
            "72321",
            "72323",
            "72413",
            "72414",
            "72421",
            "82112",
            "82117",
            "91119",
            "91121",
            "91125",
            "91126",
            "91127",
            "91212",
            "91224",
            "91225",
            "91312",
            "91313",
            "91315",
            "91316",
            "91317",
            "91319",
            "91325",
            "92211",
            "92213",
            "92313",
            "93118",
            "93127",
            "93129",
            "93212",
            "93213",
            "93214",
            "93216",
            "93218",
            "93219",
            "93223",
            "93224",
            "93226",
            "93228",
            "93229",
            "93233",
            "93235",
            "93315",
            "93316",
            "123111",
            "123112",
            "123113",
            "123121",
            "123122",
            "123131",
            "123133",
            "123134",
            "123224",
            "123225")
    
    g4 <- c("61211",
            "61214",
            "62124",
            "62125",
            "62126",
            "62127",
            "63141",
            "63142",
            "63143",
            "63144",
            "63145",
            "63146",
            "63147",
            "63148",
            "63149",
            "63151",
            "63152")
  }
  
  if (year==94){
    g1 <- c("43222",
            "43223",
            "43224",
            "43225",
            "53312",
            "54044",
            "55113",
            "56221",
            "72415",
            "72416",
            "72417",
            "72422",
            "91511",
            "91515",
            "91516",
            "93119",
            "93121",
            "93122",
            "93124",
            "93125",
            "93126",
            "93411",
            "93412",
            "93414",
            "93416",
            "93417",
            "95111",
            "95112",
            "95113",
            "95114",
            "95115",
            "95121",
            "95125",
            "96111",
            "96112",
            "96113",
            "96114",
            "101111",
            "101112",
            "101113",
            "101114",
            "101115",
            "102111",
            "102112",
            "102113",
            "102114",
            "102211",
            "102212",
            "102213",
            "102214",
            "102215",
            "103111",
            "103112",
            "103113",
            "103114",
            "103115",
            "103116",
            "104111",
            "104112",
            "104113",
            "104114",
            "104115",
            "105111",
            "105112",
            "105113",
            "105114",
            "105115",
            "124113",
            "125111",
            "125112",
            "125113",
            "125114",
            "125115",
            "125116",
            "125117",
            "125118",
            "125119",
            "125121",
            "125211",
            "125212",
            "125311",
            "125312",
            "125313",
            "125314",
            "125315",
            "125316",
            "125317",
            "125411",
            "125412",
            "125413",
            "125511",
            "126111",
            "126112",
            "126211",
            "126212",
            "127111",
            "127113",
            "127114",
            "127115",
            "127116",
            "127117",
            "127118",
            "127119",
            "127121",
            "127122",
            "127123",
            "127124",
            "127125",
            "127126",
            "127127",
            "127128",
            "127132",
            "127134",
            "127136",
            "127137",
            "139111",
            "139112",
            "139113",
            "139114",
            "139115",
            "139116",
            "139211",
            "139212",
            "139213",
            "139214",
            "139215",
            "139216",
            "139217")
    
    g2 <- c("53111",
            "53112",
            "53113",
            "53116",
            "53125",
            "53129",
            "53132",
            "53216",
            "71111",
            "71112",
            "71116",
            "71117",
            "71211",
            "71311",
            "71312",
            "72111",
            "72118",
            "72119",
            "82111",
            "82113",
            "91111",
            "91117",
            "91122",
            "91128",
            "91129",
            "91311")
    
    g3 <- c("31231",
            "31243",
            "31315",
            "31413",
            "43111",
            "43112",
            "43113",
            "43114",
            "43117",
            "43118",
            "43121",
            "43122",
            "43124",
            "43125",
            "43126",
            "43127",
            "43129",
            "43131",
            "43132",
            "43134",
            "43135",
            "43211",
            "43212",
            "43213",
            "43214",
            "43215",
            "43216",
            "43217",
            "43218",
            "43219",
            "51141",
            "51142",
            "51143",
            "51153",
            "51154",
            "51156",
            "51158",
            "51159",
            "51161",
            "51171",
            "51172",
            "51173",
            "51174",
            "51175",
            "51211",
            "51212",
            "51213",
            "51214",
            "51215",
            "51311",
            "51312",
            "53115",
            "53117",
            "53118",
            "53119",
            "53121",
            "53134",
            "53135",
            "53138",
            "53139",
            "53141",
            "53211",
            "53212",
            "53213",
            "53214",
            "53225",
            "53311",
            "54022",
            "54023",
            "54025",
            "54045",
            "55111",
            "55112",
            "71314",
            "72113",
            "72117",
            "72122",
            "72123",
            "72127",
            "72131",
            "72132",
            "72133",
            "72135",
            "72137",
            "72139",
            "72141",
            "72142",
            "72311",
            "72319",
            "72321",
            "72323",
            "72413",
            "72414",
            "72421",
            "82112",
            "82117",
            "91119",
            "91121",
            "91125",
            "91126",
            "91127",
            "91212",
            "91224",
            "91225",
            "91312",
            "91313",
            "91315",
            "91316",
            "91317",
            "91319",
            "91325",
            "92122",
            "92211",
            "92213",
            "92313",
            "93118",
            "93127",
            "93129",
            "93212",
            "93213",
            "93214",
            "93216",
            "93218",
            "93219",
            "93223",
            "93224",
            "93226",
            "93228",
            "93229",
            "93233",
            "93235",
            "93315",
            "93316",
            "123111",
            "123112",
            "123113",
            "123121",
            "123122",
            "123131",
            "123133",
            "123134",
            "123224",
            "123225")
    
    g4 <- c("61211",
            "61214",
            "63134",
            "63135",
            "63418",
            "63428",
            "63438",
            "63448")
  }
  
  if (year==93){
    g1 <- c("43222",
            "43223",
            "43224",
            "43225",
            "53312",
            "54044",
            "55113",
            "56221",
            "72415",
            "72416",
            "72417",
            "72422",
            "91511",
            "91515",
            "91516",
            "93119",
            "93121",
            "93122",
            "93124",
            "93125",
            "93126",
            "93411",
            "93412",
            "93414",
            "93416",
            "93417",
            "95111",
            "95112",
            "95113",
            "95114",
            "95115",
            "95121",
            "95125",
            "96111",
            "96112",
            "96113",
            "96114",
            "101111",
            "101112",
            "101113",
            "101114",
            "101115",
            "102111",
            "102112",
            "102113",
            "102114",
            "102211",
            "102212",
            "102213",
            "102214",
            "102215",
            "103111",
            "103112",
            "103113",
            "103114",
            "103115",
            "103116",
            "104111",
            "104112",
            "104113",
            "104114",
            "104115",
            "105111",
            "105112",
            "105113",
            "105114",
            "105115",
            "124113",
            "125111",
            "125112",
            "125113",
            "125114",
            "125115",
            "125116",
            "125117",
            "125118",
            "125119",
            "125121",
            "125211",
            "125212",
            "125311",
            "125312",
            "125313",
            "125314",
            "125315",
            "125316",
            "125317",
            "125411",
            "125412",
            "125413",
            "125511",
            "126111",
            "126112",
            "126211",
            "126212",
            "127111",
            "127113",
            "127114",
            "127115",
            "127116",
            "127117",
            "127118",
            "127119",
            "127121",
            "127122",
            "127123",
            "127124",
            "127125",
            "127126",
            "127127",
            "127128",
            "127132",
            "127134",
            "127136",
            "127137",
            "139111",
            "139112",
            "139113",
            "139114",
            "139115",
            "139116",
            "139211",
            "139212",
            "139213",
            "139214",
            "139215",
            "139216",
            "139217")
    
    g2 <- c("53111",
            "53112",
            "53113",
            "53116",
            "53125",
            "53129",
            "53132",
            "53216",
            "71111",
            "71112",
            "71116",
            "71117",
            "71211",
            "71311",
            "71312",
            "72111",
            "72118",
            "72119",
            "82111",
            "82113",
            "91111",
            "91117",
            "91122",
            "91128",
            "91129",
            "91311")
    
    g3 <- c("31231",
            "31243",
            "31315",
            "31413",
            "43111",
            "43112",
            "43113",
            "43114",
            "43117",
            "43118",
            "43121",
            "43122",
            "43124",
            "43125",
            "43126",
            "43127",
            "43129",
            "43131",
            "43132",
            "43134",
            "43135",
            "43211",
            "43212",
            "43213",
            "43214",
            "43215",
            "43216",
            "43217",
            "43218",
            "43219",
            "51141",
            "51142",
            "51143",
            "51153",
            "51154",
            "51156",
            "51158",
            "51159",
            "51161",
            "51171",
            "51172",
            "51173",
            "51174",
            "51175",
            "51211",
            "51212",
            "51213",
            "51214",
            "51215",
            "51311",
            "51312",
            "53115",
            "53117",
            "53118",
            "53119",
            "53121",
            "53134",
            "53135",
            "53138",
            "53139",
            "53141",
            "53211",
            "53212",
            "53213",
            "53214",
            "53225",
            "53311",
            "54022",
            "54023",
            "54025",
            "54045",
            "55111",
            "55112",
            "71314",
            "72113",
            "72117",
            "72122",
            "72123",
            "72127",
            "72131",
            "72132",
            "72133",
            "72135",
            "72137",
            "72139",
            "72141",
            "72142",
            "72311",
            "72319",
            "72321",
            "72323",
            "72413",
            "72414",
            "72421",
            "82112",
            "82117",
            "91119",
            "91121",
            "91125",
            "91126",
            "91127",
            "91212",
            "91224",
            "91225",
            "91312",
            "91313",
            "91315",
            "91316",
            "91317",
            "91319",
            "91325",
            "92211",
            "92213",
            "92313",
            "93118",
            "93127",
            "93129",
            "93212",
            "93213",
            "93214",
            "93216",
            "93218",
            "93219",
            "93223",
            "93224",
            "93226",
            "93228",
            "93229",
            "93233",
            "93235",
            "93315",
            "93316",
            "123111",
            "123112",
            "123113",
            "123121",
            "123122",
            "123131",
            "123133",
            "123134",
            "123224",
            "123225")
    
    g4 <- c("61211",
            "61214",
            "63134",
            "63135",
            "63418",
            "63428",
            "63438",
            "63448")
  }
  
  if (year==92 | year==91 | year==90){
    g1 <- c("43222",
            "43223",
            "43224",
            "43225",
            "53312",
            "54044",
            "55113",
            "56221",
            "72415",
            "72416",
            "72417",
            "72422",
            "91511",
            "91515",
            "91516",
            "93119",
            "93121",
            "93122",
            "93124",
            "93125",
            "93126",
            "93411",
            "93412",
            "93414",
            "93416",
            "93417",
            "95111",
            "95112",
            "95113",
            "95114",
            "95115",
            "95121",
            "95125",
            "96111",
            "96112",
            "96113",
            "96114",
            "101111",
            "101112",
            "101113",
            "101114",
            "101115",
            "102111",
            "102112",
            "102113",
            "102114",
            "102211",
            "102212",
            "102213",
            "102214",
            "102215",
            "103111",
            "103112",
            "103113",
            "103114",
            "103115",
            "103116",
            "104111",
            "104112",
            "104113",
            "104114",
            "104115",
            "105111",
            "105112",
            "105113",
            "105114",
            "105115",
            "124113",
            "125111",
            "125112",
            "125113",
            "125114",
            "125115",
            "125116",
            "125117",
            "125118",
            "125119",
            "125121",
            "125211",
            "125212",
            "125311",
            "125312",
            "125313",
            "125314",
            "125315",
            "125316",
            "125317",
            "125411",
            "125412",
            "125413",
            "125511",
            "126111",
            "126112",
            "126211",
            "126212",
            "127111",
            "127113",
            "127114",
            "127115",
            "127116",
            "127117",
            "127118",
            "127119",
            "127121",
            "127122",
            "127123",
            "127124",
            "127125",
            "127126",
            "127127",
            "127128",
            "127132",
            "127134",
            "127136",
            "127137",
            "139111",
            "139112",
            "139113",
            "139114",
            "139115",
            "139116",
            "139211",
            "139212",
            "139213",
            "139214",
            "139215",
            "139216",
            "139217")
    
    g2 <- c("53111",
            "53112",
            "53113",
            "53116",
            "53125",
            "53129",
            "53132",
            "53216",
            "71111",
            "71112",
            "71116",
            "71117",
            "71211",
            "71311",
            "71312",
            "72111",
           # "72118",
            #"72119",
            "82111",
            "82113",
            "91111",
            "91117",
            "91122",
            "91128",
            "91129",
            "91311")
    
    g3 <- c("31231",
            "31243",
            "31315",
            "31413",
            "43111",
            "43112",
            "43113",
            "43114",
            "43117",
            "43118",
            "43121",
            "43122",
            "43124",
            "43125",
            "43126",
            "43127",
            "43129",
            "43131",
            "43132",
            "43134",
            "43135",
            "43211",
            "43212",
            "43213",
            "43214",
            "43215",
            "43216",
            "43217",
            "43218",
            "43219",
            "51141",
            "51142",
            "51143",
            "51153",
            "51154",
            "51156",
            "51158",
            "51159",
            "51161",
            "51171",
            "51172",
            "51173",
            "51174",
            "51175",
            "51211",
            "51212",
            "51213",
            "51214",
            "51215",
            "51311",
            "51312",
            "53115",
            "53117",
            "53118",
            "53119",
            "53121",
            "53134",
            "53135",
            "53138",
            "53139",
            "53141",
            "53211",
            "53212",
            "53213",
            "53214",
            "53225",
            "53311",
            "54022",
            "54023",
            "54025",
            "54045",
            "55111",
            "55112",
            "71314",
            "72113",
            "72117",
            "72122",
            "72123",
            "72127",
            "72131",
            "72132",
            "72133",
            "72135",
            "72137",
            "72139",
            "72141",
            "72142",
            "72311",
            "72319",
            "72321",
            "72323",
            "72413",
            "72414",
            "72421",
            "82112",
            "82117",
            "91119",
            "91121",
            "91125",
            "91126",
            "91127",
            "91212",
            "91224",
            "91225",
            "91312",
            "91313",
            "91315",
            "91316",
            "91317",
            "91319",
            "91325",
            "92122",
            "92211",
            "92213",
            "92313",
            "93118",
            "93127",
            "93129",
            "93212",
            "93213",
            "93214",
            "93216",
            "93218",
            "93219",
            "93223",
            "93224",
            "93226",
            "93228",
            "93229",
            "93233",
            "93235",
            "93315",
            "93316",
            "123111",
            "123112",
            "123113",
            "123121",
            "123122",
            "123131",
            "123133",
            "123134",
            "123224",
            "123225")
    
    g4 <- c("61211",
            "61214",
            "63134",
            "63135",
            "63418",
            "63428",
            "63438",
            "63448")
  }
  
 
  TotalDurable[, Add_to_NonDurable := Reduce(`+`, .SD), .SDcols=g1]
  TotalDurable[, Durable_Dep := Reduce(`+`, .SD), .SDcols=g2]
  TotalDurable[, Durable_NoDep := Reduce(`+`, .SD), .SDcols=g3]
  TotalDurable[, Durable_Emergency := Reduce(`+`, .SD), .SDcols=g4]
  
  cat(TotalDurable[,mean(Add_to_NonDurable)],"\t")
  cat(TotalDurable[,mean(Durable_Dep)],"\t")
  cat(TotalDurable[,mean(Durable_NoDep)],"\t")
  cat(TotalDurable[,mean(Durable_Emergency)],"\t")
  
  #TotalDurable <- mutate_(TotalDurable, Add_to_NonDurable2 = paste(g1, collapse = "+"))
 # TotalDurable<-as.data.table(TotalDurable)
  
 #  x<-TotalDurable[,.("HHID","Add_to_NonDurable","Add_to_NonDurable2")]
  
  
  
  Durablele_Detail<-TotalDurable[,.(HHID,Add_to_NonDurable,Durable_Dep,
                                    Durable_NoDep,Durable_Emergency)]
  
  load(file = paste0(Settings$HEISProcessedPath,"Y",year,"Durables.rda"))
  Durablele_Detail<-merge(Durablele_Detail,DurableData)
  Durablele_Detail[,diff:=Durable_Exp-(Add_to_NonDurable+Durable_Dep+
                                       Durable_NoDep+Durable_Emergency)]
  
  save(Durablele_Detail, file=paste0(Settings$HEISProcessedPath,"Y",year,"Durablele_Detail.rda"))
 # a<-data.table(duplicated(Durablele_Detail$HHID))
  
  
 # load(file=paste0(Settings$HEISProcessedPath,"Y",year,"Merged4CBN1.rda"))
 # Durablele_Detail<-merge(Durablele_Detail,MD[,.(HHID,FoodExpenditure,Durable_Exp,Size)],by="HHID")
  
 # load(file=paste0(Settings$HEISProcessedPath,"Y",year,"InitialPoor.rda"))
 # Durablele_Detail<-merge(Durablele_Detail,MD[,.(HHID,Decile,Weight)])
 # Durablele_Detail[,weighted.mean(Durable_NoDep,Weight),by=Decile][order(Decile)]
 # Durablele_Detail[,weighted.mean(Durable_Emergency,Weight),by=Decile][order(Decile)]
  }



endtime <- proc.time()
cat("\n\n============================\nIt took ")
cat(endtime-starttime)